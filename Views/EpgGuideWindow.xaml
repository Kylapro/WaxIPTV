<Window x:Class="WaxIPTV.Views.EpgGuideWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="EPG Guide"
        Height="600"
        Width="1000"
        MinHeight="400"
        MinWidth="600"
        Background="{DynamicResource BgBrush}"
        Foreground="{DynamicResource TextBrush}"
        WindowStartupLocation="CenterOwner">
    <!--
        This window renders a simple EPG guide.  The guide displays a
        twelve‑hour timeline for each channel along with basic
        playback controls.  Channels are loaded from the main window
        so that the guide can reuse the same playlist and EPG data.  A
        search bar and group filter enable quick filtering of the
        displayed channels.  Clicking a programme segment shows
        detailed information above the guide and exposes a play
        button.  Double‑clicking a segment or channel row will
        immediately begin playback using the main window’s player.
    -->
    <DockPanel>
        <!-- Top bar: search box, group selector and close button -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="8">
            <TextBox x:Name="SearchBox"
                     Width="200"
                     Margin="0,0,8,0"
                     VerticalAlignment="Center"
                     TextChanged="SearchBox_TextChanged"
                     Background="{DynamicResource SurfaceBrush}"
                     Foreground="{DynamicResource TextBrush}"
                     BorderBrush="{DynamicResource DividerBrush}"
                     BorderThickness="1"/>
            <ComboBox x:Name="GroupFilter"
                      Width="150"
                      Margin="0,0,8,0"
                      VerticalAlignment="Center"
                      SelectionChanged="GroupFilter_SelectionChanged"
                      Background="{DynamicResource DropdownBrush}"
                      Foreground="{DynamicResource TextBrush}"
                      BorderBrush="{DynamicResource DividerBrush}"
                      BorderThickness="1"/>
            <Button Content="Close"
                    Width="80"
                    Margin="0"
                    Click="Close_Click"
                    Style="{DynamicResource AccentButton}"/>
        </StackPanel>

        <!-- Information panel: shows details for the selected programme -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="{DynamicResource ThemeCornerRadius}"
                Padding="8"
                Margin="8,0,8,0"
                x:Name="InfoPanel">
            <StackPanel>
                <TextBlock x:Name="InfoPlaceholder" Text="Select a programme to view details."/>
                <TextBlock x:Name="InfoTitle" FontWeight="Bold" FontSize="16" Margin="0,0,0,4" Visibility="Collapsed"/>
                <TextBlock x:Name="InfoTime" Margin="0,0,0,4" Visibility="Collapsed"/>
                <TextBlock x:Name="InfoDesc" TextWrapping="Wrap" Margin="0,0,0,8" Visibility="Collapsed"/>
                <Button x:Name="InfoPlayButton" Content="Play" Width="80" Click="InfoPlayButton_Click" Style="{DynamicResource AccentButton}" Visibility="Collapsed"/>
            </StackPanel>
        </Border>

        <!-- Timeline header showing local times -->
        <Grid DockPanel.Dock="Top" Margin="8,0,8,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.Column="0"/>
            <ScrollViewer Grid.Column="1"
                          x:Name="TimelineHeaderScroll"
                          HorizontalScrollBarVisibility="Hidden"
                          VerticalScrollBarVisibility="Hidden">
                <ItemsControl x:Name="TimelineHeader">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" IsItemsHost="True"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Width="{Binding Width}"
                                   BorderBrush="{DynamicResource DividerBrush}"
                                   BorderThickness="0,0,1,0">
                                <TextBlock Text="{Binding Label}"
                                           HorizontalAlignment="Center"
                                           Foreground="{DynamicResource TextBrush}"/>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>

        <!-- Main guide area: list of channels and their programmes -->
        <ScrollViewer x:Name="GuideScroll"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      Margin="8"
                      ScrollChanged="GuideScroll_ScrollChanged">
            <ItemsControl x:Name="TimelineList"
                          VirtualizingStackPanel.IsVirtualizing="True"
                          VirtualizingStackPanel.VirtualizationMode="Recycling">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <!-- Each channel row is wrapped in a border for better separation -->
                        <Border Margin="0,0,0,4" Padding="4" Background="{DynamicResource SurfaceBrush}" CornerRadius="{DynamicResource ThemeCornerRadius}" MouseLeftButtonDown="ChannelRow_MouseLeftButtonDown">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <!-- Channel metadata: logo and name -->
                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <Image Source="{Binding Channel.Logo}" Width="24" Height="24" Margin="0,0,4,0"/>
                                    <TextBlock Text="{Binding Channel.Name}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                </StackPanel>
                                <!-- Timeline for this channel -->
                                <ScrollViewer Grid.Column="1" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Hidden" ScrollChanged="TimelineScroll_ScrollChanged">
                                    <ItemsControl ItemsSource="{Binding Segments}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal" IsItemsHost="True"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <!-- Use a DataTrigger to display different visuals for blank vs programme segments -->
                                                <Border Width="{Binding Width}"
                                                       Height="40"
                                                       Margin="1,0"
                                                       Background="{Binding Background}"
                                                       MouseLeftButtonDown="Segment_MouseLeftButtonDown"
                                                       RequestBringIntoView="Segment_RequestBringIntoView">
                                                    <TextBlock Text="{Binding Title}" VerticalAlignment="Center" Padding="2" TextTrimming="CharacterEllipsis" Foreground="{DynamicResource TextBrush}"/>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DockPanel>
</Window>
<Window x:Class="WaxIPTV.Views.EpgGuideWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:WaxIPTV.Views"
        Title="EPG Guide"
        Height="600"
        Width="1000"
        Background="{DynamicResource BgBrush}"
        Foreground="{DynamicResource TextBrush}"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True">
    <!--
        Displays a programme guide timeline for all channels.  A search box and
        group selector allow filtering.  Selecting a programme shows its
        details in the header with a Play button.
    -->
    <DockPanel>
        <!-- Detail panel -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="{DynamicResource ThemeCornerRadius}"
                Margin="8"
                Padding="8">
            <StackPanel Orientation="Vertical">
                <TextBlock x:Name="DetailTitle" FontWeight="Bold" FontSize="16"/>
                <TextBlock x:Name="DetailTime" Margin="0,2,0,0"/>
                <TextBlock x:Name="DetailDesc" TextWrapping="Wrap" Margin="0,2,0,8"/>
                <Button x:Name="PlayProgrammeButton" Content="Play" Width="80" Click="PlayProgrammeButton_Click" Style="{DynamicResource AccentButton}" Visibility="Collapsed"/>
            </StackPanel>
        </Border>

        <!-- Filter bar -->
        <DockPanel DockPanel.Dock="Top" Margin="8">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" Margin="0,0,8,0">
                <TextBlock Text="Group" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <ComboBox x:Name="GroupFilter" Width="160"
                          SelectionChanged="GroupFilter_SelectionChanged"
                          Background="{DynamicResource DropdownBrush}"
                          Foreground="{DynamicResource TextBrush}"
                          BorderBrush="{DynamicResource DividerBrush}"
                          BorderThickness="1"/>
            </StackPanel>
            <TextBox x:Name="SearchBox" DockPanel.Dock="Right" Width="300" Margin="8,0,0,0"
                     TextChanged="SearchBox_TextChanged"
                     Background="{DynamicResource SurfaceBrush}"
                     Foreground="{DynamicResource TextBrush}"
                     BorderBrush="{DynamicResource DividerBrush}"
                     BorderThickness="1"/>
        </DockPanel>

        <!-- Timeline header showing hour markers -->
        <ScrollViewer DockPanel.Dock="Top" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Hidden" Margin="8,0,8,4">
            <ItemsControl x:Name="TimelineHeader" Width="{x:Static local:EpgGuideWindow.TimelineWidth}" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas Height="20"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Label}" Canvas.Left="{Binding Left}" FontSize="12"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Main channel/programme timeline list -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Margin="8">
            <ItemsControl x:Name="ChannelItems" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <!-- Channel info -->
                            <StackPanel Orientation="Horizontal" Grid.Column="0">
                                <Image Source="{Binding Channel.Logo}" Width="24" Height="24" Margin="0,0,6,0"/>
                                <TextBlock Text="{Binding Channel.Name}" VerticalAlignment="Center"/>
                            </StackPanel>
                            <!-- Programme timeline -->
                            <ScrollViewer Grid.Column="1" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden">
                                <ItemsControl ItemsSource="{Binding Blocks}" Width="{x:Static local:EpgGuideWindow.TimelineWidth}" SnapsToDevicePixels="True" UseLayoutRounding="True">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <Canvas Height="40" SnapsToDevicePixels="True" UseLayoutRounding="True"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="{DynamicResource SurfaceBrush}"
                                                    BorderBrush="{DynamicResource DividerBrush}"
                                                    BorderThickness="1"
                                                    Canvas.Left="{Binding Left}"
                                                    Width="{Binding Width}"
                                                    Height="40"
                                                    Padding="4,0"
                                                    MouseLeftButtonUp="ProgrammeBlock_MouseLeftButtonUp"
                                                    ToolTip="{Binding Tooltip}" SnapsToDevicePixels="True">
                                                <Grid>
                                                    <TextBlock x:Name="TitleText"
                                                               Text="{Binding Programme.Title}"
                                                               TextWrapping="NoWrap"
                                                               TextTrimming="CharacterEllipsis"
                                                               VerticalAlignment="Center"
                                                               Margin="0"
                                                               FontSize="12"/>
                                                    <Image x:Name="LogoImage" Source="{Binding Channel.Logo}" Width="16" Height="16" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed"/>
                                                </Grid>
                                            </Border>
                                            <DataTemplate.Triggers>
                                                <DataTrigger Binding="{Binding ShowTitle}" Value="False">
                                                    <Setter TargetName="TitleText" Property="Visibility" Value="Collapsed"/>
                                                    <Setter TargetName="LogoImage" Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </DataTemplate.Triggers>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DockPanel>
</Window>
